### 목차

- [**2023-07-17**](#2023-07-17)
- [**2023-07-18**](#2023-07-18)

<br>

# **2023-07-17**
## 스크럼회의(2023/07/17)

- 기존 서비스를 지하차도에 적용하자는 의견 나옴.
- 건물의 범위를 넓히는 서비스를 한다면 괜찮지만 아예 바꿔야 하는 건 어려울 것 같다.
- 온습도, 미세먼지 줄이고 침수관리 쪽으로 초점
    ⇒ 건물(지하주차장)관리, 지하차도 관리
- 운전자들은 웹사이트를 통해 정보를 조회할 수 있게
- 지하차도에 실제 설치하기는 힘들지만 설치한다는 가정으로 차수판을 활용하자.
- 지자체 대상 추가
    - 지도 어플을 하나 넣는 형식으로 실시간 댐 api를 활용하여 지도에 위험지역 표기해주는 기능
    - LED판에 미세먼지, 침수 경보 등 정보 표시
    - 앞에서 차단을 해준다는것이 차이점(입구에서 안들어가게만 하도록 해도 피해를 줄일 수 있음)
    - 차수판 설치 하고 사이렌 울림(물을 늦출 수 있음) + TTS - 현장 제제 목적

<br>

- 지자체와 기존 건물 관리의 통일성 문제
    - 알림을 서브로 가져가는 건?
    - 지하주차장 → 차수판 올라감 / 지하차도 → 사이렌 / 사이렌 → 지자체 알림 → 차수판 올림

<br>

- 사용자 없애고 재난 대비로 가는 것은?
- 사용자는 있어야 될것 같고 미세먼지와 같은 정보는 지자체가 관리하는 데이터인데 의미가 있을까?
- 입주민 없애고 세대 정보 알고 있고 알림을 주는것
- 지하차도는 차수판과 경고만
- 사용자를 없애고 지자체에게 알림
- 입주민 없애고 건의사항 대신 신고 접수
- 지자체 번호로 보내는 느낌
- 서비스의 볼륨이 없어짐.
- 건물 관리자 측면은 유지,

- 맥락을 벗어남. 대시보드 부실하다고 느끼면,
- 아파트회원 지자체 회원 → 공통 cctv 방송 알림 등
- 어떻게 갈리냐? 온습도 미세먼지 없애고 여러개를 관리하는 느낌으로
- 지자체라 함은 재난대비
- 전국에 있는 현황을 확인하며 통솔하는 입장
- cctv 여러개 봐야함.
- 지하차도 별로 알림이 올 것
- cctv 수치 원격제어 기능
- 신고페이지 괜찬
- 건의사항 빼고 할거면 주민 가입 x 주민 정보 가져오는 방법 다르게 또는 임의로 넣는다고 생각(알림용)

- 정보 제공 받은 입장
- 사용자 입장에서는 gps로 받는게 더 효율적
- 관리자 입장에서는 cctv 활용 할 것 , 진입 차단 시설 → 터널, 지하차도 일부 설치 된 바 있음 → 웹사이트 간단 조작. 제어 기기 있음. → 정보 제공 측면에서 하는 것이 좋을 듯 하다.

<br>

# 기획 회의(주제 변경) (2023/07/17)

1안 : 기존 현행 유지(건물관리만)

2안 : 건물 + 지하차도 (재난 전부)

3안 : 지하차도만

4안 : 건물 + 지하차도 (침수 포커스) 

5안 : 건물 + 지하차도 (관리인만) 

### 최종 결정
**4안 : 건물 + 지하차도 (침수 포커스)**

## 1. **지하차도**

- 구역 선택 (목록은 서비스 운영자가 제공한다고 가정?)
    - 메인 배너 바로 밑에 위치

<br>

- 지하차도 대시보드(일반인+관리인)

    <img src="/img/지하차도_대쉬보드.jpg" width="600" height="400"/>

    - CCTV(목록에서 선택)
    - 지도(지하차도 좌표 + 하천수위)
    - 신고접수 현황 ⇒ 이것만 일반인 상세 이동. (관리자도 상세 이동 가능)
    - 시간별 침수 높이(그래프)
    - 강수량 데이터(그래프?)
    - 관리자만 제어페이지(상세페이지로 이동, 신고접수만 게시판 나머지는 제어페이지로))
    - 차수판 동작여부(상단 배치)

    <br>

- 신고접수 게시판(일반인+관리인)

    <img src="/img/지하차도_신고접수.jpg" width="600" height="400"/>

    - (초록 또는 파랑) 공지사항
    - 일반인 신고접수
    - 글쓰기 버튼
    - 글쓰기 ⇒ 사진 첨부 기능
    - 수정, 삭제 (같은 휴대폰 번호 입력하면 가능)

    <br>

- 제어 페이지(관리인)

    <img src="/img/지하차도_제어.jpg" width="600" height="400"/>

    - CCTV 2개 (입구 + 내부)
    - 경고등
    - 차수막, 사이렌 동작 버튼
    - TTS
    - 1차 경고등 동작은 자동으로 할 것인가 ? : 일단 자동 아닌 것으로 하기 (추후 바뀔 가능성O)

    <br>

- 시스템

    <img src="/img/지하차도_시스템.jpg" width="600" height="400"/>

    - 일자 선택 (기간) 디폴트는 오늘날짜
    - 세부 테이블 선택
    - 조회하고 싶은 내용 선택 (센서 정보 / 사이렌 동작여부 / TTS 동작여부 / 차수 동작 여부/알림 기록)
    - 수신 알림 내역(이력) (센서 관련 정보와 메뉴 분리, 건물 관리와 ui 동등하게 진행)

<br>

- 알림함
    - 페이지 상단 종모양.!!
    - 건물 관리랑 동등하게 ui 진행

<br>

- 관리
    - 기준치 설정과 메시지 문구(TTS)를 한 화면에 배치

## 2. **건물**
- 대시보드(관리인 + 입주민)

    <img src="/img/건물_대쉬보드.jpg" width="600" height="400"/>

    - CCTV
    - 수위 그래프
    - 강수 그래프
    - 실시간 온습도 / 미세먼지
    - 신고현황
    - 관리자공지
    - 특보(비 관련만)
    - 차수판 동작여부(상단 배치)

<br>

- 건의사항 → 신고 접수(관리인 + 입주민)
    - 기능 명세서 용어 수정하기

<br>

- 제어 (+ 알림 통합)(관리인)

    <img src="/img/건물_제어.jpg" width="600" height="400"/>

    - CCTV
    - 차수판 동작
    - TTS, 앱, 문자메시지 알림 보내기

<br>

- 시스템(관리인)

    <img src="/img/건물_시스템.jpg" width="600" height="400"/>

    - 일자 선택 (기간) 디폴트는 오늘날짜
    - 세부 테이블 선택
    - 조회하고 싶은 내용 선택 로그(센서 정보 / 사이렌 동작여부 / TTS 동작여부 / 차수 동작 여부) ,알림(수신 알림 기록, 발신 알림 기록)
    - 유용한 로그(통합 테이블) → 좀 더 고민 해보기

<br>

- 관리(관리인)

    <img src="/img/건물_관리.jpg" width="600" height="400"/>

    - 메시지 문구 설정(TTS, 문자, 앱 알림)
    - 기준치 설정(1차 경고, 2차 경고)
    - 입주민 관리(위 2개랑 탭 따로)

<br>

- 건물 / 지하차도 어떻게 구별? 지급된 관리자 계정으로 구별한다고 가정

    <img src="/img/지하차도_건물_로그인선택.jpg" width="600" height="400"/>

<br>

### 기능 명세서 수정

- **관리, 알림, 대시보드**<br>
![기능명세서_관리__알림__대시보드_](/uploads/098753825351e23e6e8bdf86148b57d9/기능명세서_관리__알림__대시보드_.PNG)
- **신고접수, 마이페이지**<br>
![기능명세서_신고접수__IOT__마이페이지_](/uploads/24050cac74bf8b52ba37f1d394afc20f/기능명세서_신고접수__IOT__마이페이지_.PNG)
- **시스템페이지, 자동알림, 제어**<br>
![기능명세서_시스템페이지__자동알림__제어_](/uploads/d7a5447af5d67e2dac6562d15cbebb6b/기능명세서_시스템페이지__자동알림__제어_.PNG)
- **로그인, 회원가입, 로그아웃, 알림함**<br>
![기능명세서_로그인__회원가입__로그아웃__알림함_](/uploads/8357cc2d74f9bba2eb2f1946ad67af06/기능명세서_로그인__회원가입__로그아웃__알림함_.PNG)

<br><br>

# **2023-07-18**
<br>

## 스크럼 회의
- 코드 컨벤션 (30분 내외)
- 테이블 전체 초안
- 15~16시 컨설턴트님 컨설팅
- 17시 1차 수정
- 프론트 회의
    - 디자인 컨셉 잡기

## 1. DB 네이밍 컨벤션션

- 대/소문자 정하기
    - 테이블 : camelCase
    - 컬럼 : snake_case
    - 접두사, 접미사 , ‘_’, ‘TB’ 금지
- 기본 PK & 외래키 양식
    - [table명]_id (ex) table_id)
- 약어 금지
- 단수형 사용(복수형 금지)
- index이름
    - [table명]_idx_[column명] (ex ) person_idx_column명)
- 복합키
    - [테이블명]_pk
- 이름은 명사로

<br>

## ERD 설계 

tts / 알림내역(수신,발신) / 제어 / 알림메시지 커스텀 테이블 / 게시판 (공지, 신고) / 사이렌 / 경고로그 / 차수판 동작여부/ 

- 각자 기능별로 테이블을 맡아서 짜오고 합치기
- 조준희, 김예진 :  측정 데이터(센서, 차수판, 사이렌) 로그 테이블
- 이효경 :  회원, 인증,
- 김동현 : 게시판 (공지, 신고)
- 황윤영 : 알림내역(수신,발신)
- 황종인 : TTS, 알림 커스텀



![1](/uploads/32a676de5241853e7811c6868fc5b29d/1.PNG)
<br>

## ERD 1차 피드백
### 기획 피드백

- 접속한 유저가 어느 지역에 속해있는지 어떻게 구분
    
    지역을 선택하고 들어가는지, 위치정보를 활용할 것인지
    
    → **사용자 GPS 위치 기준으로 지도 좌표 잡아주는 것을 활용**
    

- 지자체의 관리자는 관리 지역에 대해서만 제어하는 버튼이 나오도록
    도단위 지차체 or 시단위 지자체? 
    검색시 내 지역에 대해서만 권리를 줘야 한다.
    →  검색은 가능하나, 관할 지자체의 지하차도만 제어 버튼이 보인다.

- 시민이 접속을 했을 때 보고 싶은 지역을 어떻게 검색할 것인지
    → 현재 위치 기반 n km 이내?

- 사이렌은 잘 안 들릴 수 있으니 LED 활용 좋은 것 같다.
    → 전광판 활용


---

<br>

### ERD 피드백

> **코드 컨벤션 / 전체 테이블**
> 
- 테이블명도 snake case (안되는건 아니지만 일반적으로 통일)
- date 예약어 사용 금지
- autoincrement같은건 코멘트에 안적어도 된다.
- id보다는 구별가능한 이름을 써라. → jpa적용할거면 고려만!
- pk에 bigint 사용할 필요 없다.
- 권한에 시스템 계정도 추가?
    - 시스템 여부로 확인할 수도 있음
- 외래키는 안쓰는걸 추천. 시스템인지 아닌지 확인하는 boolean 하나를 사용하는걸 추천.

> **회원**
> 
- bigint는 길이 없음 - mysql기준 통일
- 전화번호  varchar(11)
- 탈퇴처리
    - 몇번 회원인지는 남겨놓고 개인정보는 다 지우는 방법
    - 회원을 지우는 경우 회원이 했던 모든 정보가 지워짐
- 아파트랑 지자체는 가지고 있어야 할 정보가 달라서 나눌 것 같다
- 이 회원이 어디 아파트 사람인지 어떻게 구별? 시설id → 위험하다. 지하차도의 경우 유저와 시설 관계는 어떻게?
    
    [아파트] 
    
    회원:아파트 다:1
    
    [지자체] 
    
    관리자:지역 1:1
    
    한 지역에 여러개의 지하차도
    
- 탈퇴의 경우도 생각해야 됨
→ 지울 경우 모든 정보를 삭제하는 것이 아님
→ 개인 정보만 테이블에서 없애고 번호만 남긴다 → 몇 호에 살던 몇 번 회원
- id보다  seq - 이건 필수는 아님
- 로그인 타입 - 다시 고민 , 구현 고민
- 유저 테이블에는 가입 일시, 상태, 탈퇴 여부 등 있어야함
    
    

> **신고접수**
> 
- 신고 대상에 해당하는 카테고리(어느 시설, 어느 터널인지)
- 신고를 어디에 전달할 것인지
    
    → 지역을 어디로 보낼 것인지(주소 or 선택)
    
- 회원 여부 , 비회원에 대한 정보가 있어야 됨

> **알림로그**
> 
- member_id1 → receive_member 구체적으로 알아보기 쉽게

> **시설**
> 
- 아파트 여부 isApart (boolean) 활용 ?
- 지하 차도의 위치도 가지고 있어야 함(아파트는 주소로 구분 가능하지만, 지하 차도는 어떻게?)
- 시설은 지역 코드도 있어야 함.

> **알림**
> 
- 문자는 누구한테 보냈는지가 남아있어야 함
    
    문자로그도 따로 있으면 (비용이 드는 데 나갔는지 안나갔는지 확인할 수 있음.)
    
    → 문자 전송 로그 필요
    
- 웹은 받았는지 안받았는지 확인할 수 있고 사용자가 받을 수 있는 알림

- 차수판, 사이렌 작동에 대한 정보가 알림메시지에 포함되어야 함

- 그 외에는 시스템 로그
    
    → 다른 타입의 기록이니 나누어야 한다.
    
    → 읽은 여부와 읽은 시간도 들어가야 된다.
    

- 침수단계 2단계밖에 없는데 typeint나 char 활용하는 것이 좋을 것 같다
- 기기구분, 알림출처,
    - 한글로 하기보다는 코드화 (공통 코드 테이블로 빼기)
    - 남/여 와 같이 절대 안바뀌는 건 하드코딩 해도 괜찮다

> **기기관리**
> 
- 센서가 많아질 경우 코드 테이블을 만들어 관리함.(센서의 이름을 한글로 잘 가지는 않음)
- 센서가 정해져 있으니 기기 관리 테이블 제거 후 센서 로그에서 건물 번호로 조회

> **결론**
> 
- 열심히 짠건 보이지만 비슷한걸 너무 합쳐서 복잡도가 높고 직관성이 떨어질 수 있다. 반정규화 처럼 필요하다면 똑같은 테이블도 나누는걸 고민해보기.
- 공통 코드 테이블. 기기 등록 페이지가 있다면 하드코딩 줄이기 위해 이런 류는 공통 코드 그룹 테이블을 만든다.
---
